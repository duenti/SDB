{% extends 'base.html' %}
{% load static %}

{% block title %}
    SDB: Specificity Determinant Data Base &lt; Family
{% endblock %}

{% block links %}
    <link rel="stylesheet" href="{% static 'feature-viewer/feature-viewer.min.css' %}" type="text/css">
    <script src="{% static 'feature-viewer/d3.v3.min.js' %}"></script>
    <script src="{% static 'feature-viewer/bootstrap.min.js' %}"></script>
    <script src="{% static 'feature-viewer/feature-viewer.min.js' %}"></script>
{% endblock %}

{% block content %}
    <div id="content">
        <!-- Content -->
        <h1>{{ family.pfama_acc }}</h1>

        <div id="wiki">
            <article id="wikipedia">
            </article>
        </div>

        <div id="communities">
            <h2>Communities</h2>
            Select the cutoff:
            <select id="select_cut">
                <option>0.75</option>
                <option>0.80</option>
                <option>0.85</option>
            </select>

            <div id="comm_pos">
                <div id="fv1"></div>
                <script>
                    {{ prot_vist_src|safe }}
                </script>
            </div>

            <div class="table-wrapper" style="margin-top: 20px">
                <table class="fl-table">
                    <thead>
                    <tr>
                        <th>Community</th>
                        <th>Residues</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for comm in communities %}
                        <tr>
                            <td>Community {{ forloop.counter }}</td>
                            <td>{{ comm }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>


        <div id="references">
            {% if references|length > 0 %}
                <h2>References</h2>
                <ul>
                {% for ref,pmid in references %}
                    <li><a class="ref_link" href="https://europepmc.org/article/MED/{{ pmid }}" target="_blank">{{ ref }}</a></li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>


    </div>
{% endblock %}

{% block foot_links %}
<script>
$(function() {
     var URL = "http://en.wikipedia.org/w/api.php?action=query&prop=extracts&format=json&origin=*&exintro=&titles={{ wiki_title }}";
     $.ajax({
        url: URL,
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        type: "POST", /* or type:"GET" or type:"PUT" */
        dataType: "json",
        data: {
        },
        success: function (result) {
            let res = result.query;
            var q = Object.keys(res.pages)[0];
            var wiki_obj = res.pages[q];
            //html += res.pages[q];
            let html = "<h2>" + wiki_obj.title + "</h2>";
            html += wiki_obj.extract;
            $("#wikipedia").empty();
            $("#wikipedia").append(html);
        },
        error: function () {
            console.log("error");
        }
    });
 });
</script>
{% endblock %}